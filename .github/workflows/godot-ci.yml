name: "godot-ci export"
on:
  push:
    branches:
      - main
      - dev
env:
  GODOT_VERSION: 3.3
  EXPORT_NAME: godot-game-template

jobs:
  # export-windows:
  #   name: Windows Export
  #   runs-on: ubuntu-latest
  #   container:
  #     image: barichello/godot-ci:3.3
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v1
  #     - name: Setup
  #       run: |
  #         mkdir -v -p ~/.local/share/godot/templates
  #         mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
  #     - name: Windows Build
  #       run: |
  #         mkdir -v -p build/windows
  #         godot -v --export "Windows Desktop" ./build/windows/$EXPORT_NAME.exe
  #     - name: Upload Artifact
  #       uses: actions/upload-artifact@v1
  #       with:
  #         name: windows
  #         path: build/windows

  # export-linux:
  #   name: Linux Export
  #   runs-on: ubuntu-latest
  #   container:
  #     image: barichello/godot-ci:3.3
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v1
  #     - name: Setup
  #       run: |
  #         mkdir -v -p ~/.local/share/godot/templates
  #         mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
  #     - name: Linux Build
  #       run: |
  #         mkdir -v -p build/linux
  #         godot -v --export "Linux/X11" ./build/linux/$EXPORT_NAME.x86_64
  #     - name: Upload Artifact
  #       uses: actions/upload-artifact@v1
  #       with:
  #         name: linux
  #         path: build/linux

  # export-web:
  #   name: Web Export
  #   runs-on: ubuntu-latest
  #   container:
  #     image: barichello/godot-ci:3.3
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v1
  #     - name: Setup
  #       run: |
  #         mkdir -v -p ~/.local/share/godot/templates
  #         mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
  #     - name: Web Build
  #       run: |
  #         mkdir -v -p build/web
  #         godot -v --export "HTML5" ./build/web/index.html
  #     - name: Upload Artifact
  #       uses: actions/upload-artifact@v1
  #       with:
  #         name: web
  #         path: build/web
  #     # Installing rsync is needed in order to deploy to GitHub Pages. Without it, the build will fail.
  #     - name: Install rsync ðŸ“š
  #       run: |
  #         apt-get update && apt-get install -y rsync
  #     - name: Deploy to GitHub Pages ðŸš€
  #       uses: JamesIves/github-pages-deploy-action@releases/v3
  #       with:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #         BRANCH: gh-pages # The branch the action should deploy to.
  #         FOLDER: build/web # The folder the action should deploy.
  #     - name: Zip Folder
  #       run: zip -r itch.zip build/web
  #     - name: Deploy to itch.io
  #       #Comment if you want to enable itch.io automatic deploy
  #       if: ${{ false }}
  #       uses: josephbmanley/butler-publish-itchio-action@master
  #       env:
  #         BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}
  #         CHANNEL: HTML
  #         ITCH_GAME: ${{ secrets.ITCH_GAME }}
  #         ITCH_USER: ${{ secrets.ITCH_USER }}
  #         PACKAGE: itch.zip

  # export-mac:
  #   name: Mac Export
  #   runs-on: ubuntu-latest
  #   container:
  #     image: barichello/godot-ci:3.3
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v1
  #     - name: Setup
  #       run: |
  #         mkdir -v -p ~/.local/share/godot/templates
  #         mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
  #     - name: Mac Build
  #       run: |
  #         mkdir -v -p build/mac
  #         godot -v --export "Mac OSX" ./build/mac/$EXPORT_NAME.zip
  #     - name: Upload Artifact
  #       uses: actions/upload-artifact@v1
  #       with:
  #         name: mac
  #         path: build/mac

  # debug.keystore?
  export_android_debug:
    name: Android Debug Export
    runs-on: ubuntu-latest
    container:
      image: barichello/godot-ci:3.3
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Setup Android SDK
        uses: android-actions/setup-android@v2
      - name: Setup
        run: |
          mkdir -v -p ~/.local/share/godot/templates
          mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          ls /github/home/.android/sdk/tools/bin
          ls /github/home/.android/sdk/tools/android
          ls /.config/
          godot -v -q
          ls /.config/
      - name: Godot Export
        run: |
          chown -R root:root /github/home
          mkdir -v -p build/android
          godot -v --export-debug "Linux" ./build/android/$EXPORT_NAME-debug.apk
      - name: Upload Artifact
        uses: actions/upload-artifact@v1
        with:
          name: android_debug
          path: build/android

  # export-android:
  #   name: Android Export
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: croconut/godot-multi-builder@v1
  #       with:
  #         #comma separated export presets
  #         names: "Android"
  #         # defaults to true, Android currently only exports to debug
  #         debug-mode: "true"
  #         # outputs to path-to-game/builds/builds.zip
  #         # if run multiple times, you can use the step's output variable
  #         # to retrieve the separate builds.zip files
  #         # if any zip files are too big for your purposes, unzipping is
  #         # likely your best bet
  #     - run: |
  #         sudo mv builds/builds.zip builds/$EXPORT_NAME.apk
  #     - uses: actions/upload-artifact@v1
  #       with:
  #         name: android
  #         path: builds
